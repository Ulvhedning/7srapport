<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>7S-RAPPORT MRPAS</title>

  <!-- jsPDF fÃ¶r PDF-export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    :root {
      --bg: #f7f7f7;
      --card: #ffffff;
      --primary: #0f5132;   /* olivgrÃ¶n kÃ¤nsla */
      --text: #222;
      --muted: #666;
      --border: #dcdcdc;
      --accent: #2a6f3e;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      line-height: 1.4;
    }

    .container {
      max-width: 780px;
      margin: 0 auto;
      padding: 16px;
    }

    header.header {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 12px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
    }

    .header-img {
      max-height: 90px;
      width: auto;
      object-fit: contain;
      border-radius: 8px;
    }

    h1 {
      font-size: 1.6rem;
      color: var(--primary);
      margin: 16px 0 8px;
    }

    form {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
    }

    fieldset {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
      margin: 10px 0 14px;
      background: #fff;
    }

    legend {
      font-weight: 600;
      color: var(--primary);
      padding: 0 6px;
    }

    small {
      color: var(--muted);
      display: block;
      margin-bottom: 8px;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 8px;
      align-items: start;
    }

    textarea, input[type="text"] {
      font-size: 1.2em; /* lika stor som rubriker */
      padding: 16px;
      border-radius: 8px;
      border: 1px solid var(--border);
      width: 100%;
      background: #fafafa;
    }

    /* SpaningsfrÃ¥gan 200% stÃ¶rre i nederkant */
    #spaningsfraga {
      font-size: 1.2em;
      padding: 32px;       /* 200% jÃ¤mfÃ¶rt med 16px baseline */
      min-height: 200px;   /* visuellt stÃ¶rre */
      line-height: 1.5;
      background: #f5fff7; /* lÃ¤tt grÃ¶n ton fÃ¶r att sticka ut */
      border-color: #cfe6d5;
    }

    button {
      appearance: none;
      border: 1px solid var(--border);
      background: #fff;
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    button.primary {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }

    pre#output {
      background: #111;
      color: #d6f3da;
      padding: 12px;
      border-radius: 10px;
      overflow: auto;
      border: 1px solid #333;
      min-height: 120px;
      font-size: 0.95em;
    }

    .footer-note {
      color: var(--muted);
      font-size: 0.9em;
      margin-top: 8px;
    }

    /* Mikrofonknapp */
    .mic-btn {
      font-size: 1.1em;
      background: #fff;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header med logga/foto: ersÃ¤tt src med din faktiska fil/URL -->
    <header class="header">
     <img src="mrpas-operator.png" alt="MRPAS OperatÃ¶r" class="header-<header class="header">
  <img src="mrpas-operator.png" alt="MRPAS OperatÃ¶r" class="header-img" />
</header>
  </header>

    <h1>7S-RAPPORT RPAS</h1>

    <form id="rapportForm" onsubmit="return false;">
      <!-- SpaningsfrÃ¥ga -->
      <fieldset>
        <legend>ğŸ¯ SpaningsfrÃ¥ga</legend>
        <small>Vad vill vi fÃ¥ svar pÃ¥ med denna spaning?</small>
        <div class="row">
          <textarea id="spaningsfraga" placeholder="Beskriv uppgiften/NAI/PRI..."></textarea>
          <button type="button" class="mic-btn" onclick="startVoiceForField('spaningsfraga')">ğŸ¤</button>
        </div>
      </fieldset>

      <!-- 1. Stund -->
      <fieldset>
        <legend>1. ğŸ•’ Stund</legend>
        <small>Tidpunkt â€“ NÃ¤r observationen gjordes (ex: 121500Z)</small>
        <div class="row">
          <textarea id="stund" placeholder="Ex: 121500Z"></textarea>
          <button type="button" class="mic-btn" onclick="startVoiceForField('stund')">ğŸ¤</button>
        </div>
      </fieldset>

      <!-- 2. StÃ¤lle -->
      <fieldset>
        <legend>2. ğŸ“ StÃ¤lle</legend>
        <small>Plats â€“ Var observationen gjordes (ex: vÃ¤g Bâ€“C, MGRS XX1234)</small>
        <div class="row">
          <textarea id="stalle" placeholder="Ex: MGRS 33V XH 1234 5678"></textarea>
          <button type="button" class="mic-btn" onclick="startVoiceForField('stalle')">ğŸ¤</button>
        </div>
      </fieldset>

      <!-- 3. Styrka -->
      <fieldset>
        <legend>3. ğŸ‘¥ Styrka</legend>
        <small>Antal â€“ Hur mÃ¥nga som observerades (ex: 2 fordon, 6 personer)</small>
        <div class="row">
          <textarea id="styrka" placeholder="Ex: 2 fordon, 6 personer"></textarea>
          <button type="button" class="mic-btn" onclick="startVoiceForField('styrka')">ğŸ¤</button>
        </div>
      </fieldset>

      <!-- 4. Slag -->
      <fieldset>
        <legend>4. ğŸš› Slag</legend>
        <small>Typ â€“ Modell av fordon, truppslag eller hÃ¤ndelsetyp</small>
        <div class="row">
          <textarea id="slag" placeholder="Ex: pansarterrÃ¤ngbil, infanteri"></textarea>
          <button type="button" class="mic-btn" onclick="startVoiceForField('slag')">ğŸ¤</button>
        </div>
      </fieldset>

      <!-- 5. SysselsÃ¤ttning -->
      <fieldset>
        <legend>5. âš™ï¸ SysselsÃ¤ttning</legend>
        <small>Aktivitet â€“ Vad de gjorde</small>
        <div class="row">
          <textarea id="sysselsattning" placeholder="Ex: lastar materiel, marschfÃ¶rberedelser"></textarea>
          <button type="button" class="mic-btn" onclick="startVoiceForField('sysselsattning')">ğŸ¤</button>
        </div>
      </fieldset>

      <!-- 6. Symbol -->
      <fieldset>
        <legend>6. ğŸ·ï¸ Symbol</legend>
        <small>MÃ¤rkning â€“ Nummer, fÃ¤rg, emblem, utseende</small>
        <div class="row">
          <textarea id="symbol" placeholder="Ex: blÃ¥ markering, siffror pÃ¥ fordon"></textarea>
          <button type="button" class="mic-btn" onclick="startVoiceForField('symbol')">ğŸ¤</button>
        </div>
      </fieldset>

      <!-- 7. Sagesman -->
      <fieldset>
        <legend>7. ğŸ§‘â€âœˆï¸ Sagesman</legend>
        <small>Vem â€“ Vem som gjort iakttagelsen (ex: RPAS-operatÃ¶r, plattform)</small>
        <div class="row">
          <textarea id="sagesman" placeholder="Ex: RPAS operatÃ¶r Alfa, ANAFI USA"></textarea>
          <button type="button" class="mic-btn" onclick="startVoiceForField('sagesman')">ğŸ¤</button>
        </div>
      </fieldset>
      
<fieldset>
  <legend>ğŸ“ Plats av intresse</legend>
  <input type="text" id="plats" placeholder="Ex: 59.3293, 18.0686" />
  <button onclick="openInMaps()">Ã–ppna i Google Maps</button>
</fieldset>

      <!-- Bilaga -->
      <fieldset>
        <legend>ğŸ“ Bilaga</legend>
        <small>Bifoga en bild eller fil som hÃ¶r till rapporten</small>
        <input type="file" id="bilaga" accept="image/*,.pdf,.doc,.txt" />
      </fieldset>

      <!-- Export-knapp -->
      <div class="actions">
        <button type="button" class="primary" onclick="exportReport()">ğŸ“¤ Exportera rapport</button>
      </div>
    </form>

    <h2 style="margin-top:16px;">Export</h2>
    <div class="actions" id="shareActions"></div>
    <pre id="output"></pre>
    <div class="footer-note">Tip: Efter export, anvÃ¤nd knapparna fÃ¶r Mail, SMS, Utskrift eller PDF.</div>
  </div>

  <script>
    // ===== RÃ¤knare fÃ¶r rapportnummer (start 1000) =====
    function getNextReportNumber() {
      let current = localStorage.getItem("reportCounter");
      if (!current) {
        current = 1000;
      } else {
        current = parseInt(current, 10) + 1;
      }
      localStorage.setItem("reportCounter", current);
      return current;
    }

    // ===== Generera rapport-ID =====
    function generateReportId() {
      const number = getNextReportNumber();
      return `RPAS_${number}`;
    }

    // ===== RÃ¶stinmatning fÃ¶r specifikt fÃ¤lt =====
    function startVoiceForField(fieldId) {
      try {
        const recognition = new webkitSpeechRecognition();
        recognition.lang = "sv-SE";
        recognition.start();
        recognition.onresult = function(event) {
          const text = event.results[0][0].transcript;
          const el = document.getElementById(fieldId);
          el.value = (el.value ? el.value + " " : "") + text;
        };
      } catch (e) {
        alert("RÃ¶stinmatning stÃ¶ds inte i denna webblÃ¤sare.");
      }
    }

    // ===== Exportera rapport =====
    function exportReport() {
      const rapport = {
        id: generateReportId(),
        spaningsfraga: document.getElementById("spaningsfraga").value.trim(),
        stund: document.getElementById("stund").value.trim(),
        stalle: document.getElementById("stalle").value.trim(),
        styrka: document.getElementById("styrka").value.trim(),
        slag: document.getElementById("slag").value.trim(),
        sysselsattning: document.getElementById("sysselsattning").value.trim(),
        symbol: document.getElementById("symbol").value.trim(),
        sagesman: document.getElementById("sagesman").value.trim(),
        timestamp: new Date().toISOString()
      };

      // Bilaga
      const fileInput = document.getElementById("bilaga");
      if (fileInput && fileInput.files && fileInput.files.length > 0) {
        rapport.bilaga = fileInput.files[0].name; // vi sparar filnamn i exporten
      } else {
        rapport.bilaga = "Ingen";
      }

      // Visa JSON
      document.getElementById("output").textContent = JSON.stringify(rapport, null, 2);

      // Skapa delningsknappar
      createShareButtons(rapport);
    }

    // ===== Formatera rapporttext fÃ¶r delning (mail/SMS/print) =====
    function formatReportText(rapport) {
      return `
ğŸ›°ï¸ 7S-RAPPORT MRPAS
ğŸ“Œ ID: ${rapport.id}
ğŸ“… Tidpunkt: ${rapport.stund}
ğŸ“ Plats: ${rapport.stalle}
ğŸ‘¥ Styrka: ${rapport.styrka}
ğŸš› Typ: ${rapport.slag}
âš™ï¸ Aktivitet: ${rapport.sysselsattning}
ğŸ·ï¸ MÃ¤rkning: ${rapport.symbol}
ğŸ§‘â€âœˆï¸ Sagesman: ${rapport.sagesman}

ğŸ¯ SpaningsfrÃ¥ga:
${rapport.spaningsfraga}

ğŸ“ Bilaga: ${rapport.bilaga}
ğŸ•“ Skapad: ${rapport.timestamp}
`.trim();
    }

    // ===== Knappar fÃ¶r delning =====
    function createShareButtons(rapport) {
      const share = document.getElementById("shareActions");
      share.innerHTML = ""; // rensa tidigare knappar

      const rapportText = formatReportText(rapport);

      // Mail
      const mailBtn = document.createElement("button");
      mailBtn.textContent = "ğŸ“§ Maila";
      mailBtn.onclick = () => {
        window.location.href = `mailto:?subject=7S-RAPPORT ${rapport.id}&body=${encodeURIComponent(rapportText)}`;
      };

      // SMS
      const smsBtn = document.createElement("button");
      smsBtn.textContent = "ğŸ“± SMS";
      smsBtn.onclick = () => {
        window.location.href = `sms:?body=${encodeURIComponent(rapportText)}`;
      };

      // Skriv ut
      const printBtn = document.createElement("button");
      printBtn.textContent = "ğŸ–¨ï¸ Skriv ut";
      printBtn.onclick = () => {
        const win = window.open("", "", "width=800,height=900");
        win.document.write(`<pre style="font-family:monospace;white-space:pre-wrap;">${rapportText}</pre>`);
        win.document.close();
        win.focus();
        win.print();
      };

      // PDF
      const pdfBtn = document.createElement("button");
      pdfBtn.textContent = "ğŸ“„ PDF";
      pdfBtn.onclick = () => exportPDF(rapport);

      share.appendChild(mailBtn);
      share.appendChild(smsBtn);
      share.appendChild(printBtn);
      share.appendChild(pdfBtn);
    }

    // ===== PDF-export med logga =====
    function exportPDF(rapport) {
      try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Ladda logga frÃ¥n header (anvÃ¤nder fÃ¶rsta bildens src)
        const headerImg = document.querySelector(".header-img");
        const src = headerImg ? headerImg.src : null;

        if (!src) {
          // Ingen bild hittad â€“ fortsÃ¤tt med text
          drawPdfContent(doc, rapport, null);
          doc.save(`${rapport.id}.pdf`);
        } else {
          const img = new Image();
          img.crossOrigin = "anonymous";
          img.src = src;
          img.onload = function() {
            drawPdfContent(doc, rapport, img);
            doc.save(`${rapport.id}.pdf`);
          };
          img.onerror = function() {
            // Om bilden inte kan laddas: fortsÃ¤tt utan logga
            drawPdfContent(doc, rapport, null);
            doc.save(`${rapport.id}.pdf`);
          };
        }
      } catch (e) {
        alert("PDF-export misslyckades: " + e.message);
      }
    }

    // Rita PDF-innehÃ¥ll
    function drawPdfContent(doc, rapport, img) {
      if (img) {
        // Logga uppe till vÃ¤nster
        doc.addImage(img, "PNG", 10, 10, 30, 30);
      }
      // Titel
      doc.setFontSize(18);
      doc.text("7S-RAPPORT RPAS", 46, 20);

      // InnehÃ¥ll
      doc.setFontSize(12);
      let y = 50;
      const line = (label, value) => {
        doc.text(`${label}: ${value || "-"}`, 10, y);
        y += 8;
      };

      line("ID", rapport.id);
      line("Tidpunkt", rapport.stund);
      line("Plats", rapport.stalle);
      line("Styrka", rapport.styrka);
      line("Typ", rapport.slag);
      line("Aktivitet", rapport.sysselsattning);
      line("MÃ¤rkning", rapport.symbol);
      line("Sagesman", rapport.sagesman);

      doc.text("SpaningsfrÃ¥ga:", 10, y + 4);
      doc.text(rapport.spaningsfraga || "-", 10, y + 12, { maxWidth: 190 });
      y += 28;

      line("Bilaga", rapport.bilaga);
      line("Skapad", rapport.timestamp);
    }
    <input type="file" id="bilaga" accept="image/*" />
  </script>
</body>
</html>
